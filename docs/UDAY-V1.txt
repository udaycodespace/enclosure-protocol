# ENCLOSURE BACKEND STATE TRANSITION GUARDS & SERVICES
## NestJS Architecture Mapping (FINAL)

This document maps each transition from UDAY.txt (authoritative security contract) to:
1. Guard name — enforces authentication, authorization, state preconditions, session/OTP rules
2. Service name — executes state transition, side effects, and audit logging

Names encode authority boundaries explicitly.
This file is COMPLETE and IMMUTABLE.

---

## ROOM STATE TRANSITIONS

TRANSITION: ROOM_CREATED → INVITE_SENT  
Guard: CreatorRoomInviteGuard  
Service: RoomInviteService  

TRANSITION: INVITE_SENT → JOINED  
Guard: CounterpartyRoomJoinGuard  
Service: RoomJoinService  

TRANSITION: JOINED → LOCKED  
Guard: ParticipantRoomLockGuard  
Service: RoomLockService  

TRANSITION: LOCKED → IN_PROGRESS  
Guard: SystemRoomProgressGuard  
Service: RoomProgressService  

TRANSITION: IN_PROGRESS → UNDER_VALIDATION  
Guard: ParticipantRoomValidationStartGuard  
Service: RoomValidationStartService  

TRANSITION: UNDER_VALIDATION → SWAP_READY  
Guard: AdminRoomSwapApprovalGuard  
Service: RoomSwapApprovalService  

TRANSITION: SWAP_READY → SWAPPED  
Guard: SystemAtomicSwapGuard  
Service: AtomicSwapExecutionService  

TRANSITION: IN_PROGRESS → FAILED  
Guard: RoomFailureGuard  
Service: RoomFailureService  

TRANSITION: INVITE_SENT → EXPIRED  
Guard: SystemRoomExpiryGuard  
Service: RoomExpiryService  

---

## CONTAINER STATE TRANSITIONS

TRANSITION: EMPTY → ARTIFACT_PLACED  
Guard: ContainerOwnerArtifactUploadGuard  
Service: ContainerArtifactUploadService  

TRANSITION: ARTIFACT_PLACED → SEALED  
Guard: ContainerOwnerSealGuard  
Service: ContainerSealService  

TRANSITION: SEALED → UNDER_VALIDATION  
Guard: SystemContainerValidationStartGuard  
Service: ContainerValidationStartService  

TRANSITION: UNDER_VALIDATION → VALIDATED  
Guard: AdminContainerApproveGuard  
Service: ContainerApproveService  

TRANSITION: UNDER_VALIDATION → VALIDATION_FAILED  
Guard: AdminContainerRejectGuard  
Service: ContainerRejectService  

TRANSITION: VALIDATED → TRANSFERRED  
Guard: SystemContainerTransferGuard  
Service: ContainerTransferService  

---

## PAYMENT STATE TRANSITIONS

TRANSITION: PENDING → CONFIRMED  
Guard: RazorpayWebhookGuard  
Service: PaymentConfirmationService  

TRANSITION: PENDING → FAILED  
Guard: RazorpayWebhookGuard  
Service: PaymentFailureService  

---

## ARTIFACT OPERATIONS (NON-STATE)

OPERATION: ARTIFACT CREATE  
Guard: ContainerOwnerArtifactCreateGuard  
Service: ArtifactCreateService  

OPERATION: ARTIFACT DELETE  
Guard: ContainerOwnerArtifactDeleteGuard  
Service: ArtifactDeleteService  

OPERATION: ARTIFACT VIEW  
Guard: ArtifactAccessGuard  
Service: ArtifactViewService  

---

## SUMMARY

Total Room Transitions: 9  
Total Container Transitions: 6  
Total Payment Transitions: 2  
Total Artifact Operations: 3  

Total Guards: 20  
Total Services: 20  

All mappings are derived strictly from UDAY.txt.
No authority leakage exists.
No transition is omitted.
No guard allows more power than defined in the contract.

END OF FILE.
